(function(c){var b={confirmDelete:false,maxNbTags:false};function d(g,f){this.options=f;this.$select=g;this.$select.hide();this.$select.wrapAll(c('<div class="tagger-container"></div>'));this.$container=g.parents(".tagger-container");this.$input=c('<input type="text" />');this.$select.after(this.$input);var e=this;this.$select.find("option").each(function(){e.addTag(c(this).val())});this.setEvents()}d.prototype={constructor:d,getTags:function(){var e=[];this.$container.find(".tagger-tag").each(function(){e.push(c(this).data("value"))});return e},removeTag:function(e){this.$container.find(".tagger-tag").filter(function(){return c.data(this,"value")===e}).remove()},removeTags:function(){this.$container.find(".tagger-tag").remove()},setTags:function(e){this.removeTags();for(var f=0;f<e.length;f++){this.addTag(e[f])}},reachedNbMaxTags:function(){return this.options.maxNbTags&&this.getTags().length>=this.options.maxNbTags},setEvents:function(){var e=this;this.$input.on("blur",function(g){var f=e.$container.find(".tagger-tag");f.removeClass("confirm");f.last().after(e.$input)});this.$input.on("paste",function(g){if(e.reachedNbMaxTags()){g.preventDefault();g.stopPropagation()}else{var f=this;setTimeout(function(h){e.adjustInputWidth(c(f).val())},0)}});this.$input.on("keyup",function(f){switch(f.which){case 8:case 46:e.adjustInputWidth();break}});this.$input.on("keydown",function(g){if(g.which!==8&&g.which!==46){e.$container.find(".tagger-tag").removeClass("confirm")}switch(g.which){case 9:case 13:if(c.trim(e.$input.val())!==""){e.addTag();g.preventDefault();g.stopPropagation()}break;case 8:case 46:var h=e.$input.val();if(h.length===0){var f;if(g.which===8){f=e.$input.prev(".tagger-tag")}else{f=e.$input.next(".tagger-tag")}f.siblings().removeClass("confirm");if(e.options.confirmDelete){if(f.hasClass("confirm")){e.removeTag(f.data("value"))}else{f.addClass("confirm")}}else{e.removeTag(f.data("value"))}}e.adjustInputWidth();break;case 46:var h=e.$input.val();if(h.length===0){e.removeTag(e.$input.next(".tagger-tag").data("value"))}else{e.adjustInputWidth()}break;case 37:var h=e.$input.val();if(h.length===0){e.goToPreviousTag()}break;case 39:var h=e.$input.val();if(h.length===0){e.goToNextTag()}break;case 38:break;case 40:break;default:if(!g.ctrlKey&&e.reachedNbMaxTags()){g.preventDefault();g.stopPropagation()}break}});this.$input.on("keypress",function(f){if(f.keyCode!==8&&f.keyCode!==46){e.$container.find(".tagger-tag").removeClass("confirm")}e.adjustInputWidth(e.$input.val()+String.fromCharCode(f.keyCode))});this.$container.on("click",function(f){e.$input.focus()});this.$container.on("click",".tagger-tag .remove-tag",function(f){e.removeTag(c(f.target).parents(".tagger-tag").data("value"))})},findTag:function(e){return this.$container.find(".tagger-tag").filter(function(){return c.data(this,"value")==e})},addTag:function(f){f=c.trim(f||this.$input.val());if(f!==""){var g=this.findTag(f);if(g.length>0){g.css("opacity",0).animate({opacity:1},300)}else{var e=c('<div class="tagger-tag">'+a(f)+'<span class="remove-tag">&times;</span></div>');e.data("value",f);this.$input.before(e);this.inputReset(true)}}},goToPreviousTag:function(){this.$input.prev(".tagger-tag").before(this.$input);this.inputReset()},goToNextTag:function(){this.$input.next(".tagger-tag").after(this.$input);this.inputReset()},inputReset:function(f){this.$input.val("");this.$input.width(1);if(!f){var e=this;setTimeout(function(){e.$input.focus()},10)}},adjustInputWidth:function(f){f=f||this.$input.val();c("taggerWidth").remove();var e=c("<taggerWidth/>").css({position:"absolute",top:-9999,left:-9999,fontSize:this.$input.css("fontSize"),fontFamily:this.$input.css("fontFamily"),fontWeight:this.$input.css("fontWeight"),letterSpacing:this.$input.css("letterSpacing"),whiteSpace:"nowrap"});e.html(a(f));c("body").append(e);var g=this.$input.outerWidth()-this.$input.width();this.$input.width(Math.min(this.$container.width()-g,e.width()+1))}};var a=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/ /g,"&nbsp;")};c.fn.tagger=function(h,f){var e=this;var i=c(this).data("tagger");if(!i){var g=c.extend({},b,h);return this.each(function(){var j=new d(c(this),g);c(this).data("tagger",j)})}else{if(i[h]){return i[h](f)}}}}(window.jQuery));